---
apiVersion: v1
kind: ConfigMap
metadata:
  name: cloudflared-config
  namespace: network
data:
  config.yaml: |
    # Tunnel routes configuration
    ingress:
      # n8n automation platform
      - hostname: n8n.${CLUSTER_DOMAIN}
        service: http://n8n.automation.svc.cluster.local:5678

      # Test route (homepage)
      - hostname: test.${CLUSTER_DOMAIN}
        service: http://homepage.home.svc.cluster.local:3000

      # Flux webhook receiver
      - hostname: flux-webhook.${CLUSTER_DOMAIN}
        service: http://webhook-receiver.flux-system.svc.cluster.local:80

      # Docker Registry (private container registry)
      - hostname: ${REGISTRY_URL}
        service: http://docker-registry.registry.svc.cluster.local:5000

      # Dynamic apps wildcard route (routes to Cilium Gateway)
      - hostname: "*.${APPS_SUBDOMAIN}"
        service: https://192.168.5.250:443
        originRequest:
          noTLSVerify: true

      # Catch-all rule (required)
      - service: http_status:404
